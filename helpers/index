const { google } = require("googleapis");

const helpers = {};

helpers.measuringType = (name) => (name.match(/\(шт\)/gm) ? "кг." : "г.");

helpers.arrayValuesToNumber = (array) =>
  array.map((value) => parseFloat(value.replace(",", ".")));

helpers.getStockBalance = async function (string = "total") {
  const range = string === "total" ? process.env.TOTAL_STOCK_REMAINS_CELLS : process.env.TOTAL_STOCK_ORDERED_CELLS;
  const auth = new google.auth.GoogleAuth({
    keyFile: "keys.json",
    scopes: "https://www.googleapis.com/auth/spreadsheets",
  });

  const authClientObject = await auth.getClient();
  const googleSheetsInstance = google.sheets({
    version: "v4",
    auth: authClientObject,
  });
  const spreadsheetId = process.env.GOOGLE_ORDER_SHEET;

  const readData = await googleSheetsInstance.spreadsheets.values.get({
    auth,
    spreadsheetId,
    range: "Склад" + range,
  });

  if (readData.data.values) {
    return readData.data.values;
  }
};

helpers.setStockBalance = async function (array) {
  const auth = new google.auth.GoogleAuth({
    keyFile: "keys.json",
    scopes: "https://www.googleapis.com/auth/spreadsheets",
  });

  const authClientObject = await auth.getClient();
  const googleSheetsInstance = google.sheets({
    version: "v4",
    auth: authClientObject,
  });
  const spreadsheetId = process.env.GOOGLE_ORDER_SHEET;

  let renderArray = [array];
  await googleSheetsInstance.spreadsheets.values.update({
    auth,
    spreadsheetId,
    range: "Склад" + process.env.TOTAL_STOCK_ORDERED_CELLS,
    valueInputOption: "USER_ENTERED",
    resource: {
      values: renderArray,
    },
  });
};

module.exports = helpers;
